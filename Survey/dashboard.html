<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Dashboard â€” NC II Survey</title><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet"><script src="https://cdn.tailwindcss.com"></script><link rel="stylesheet" href="style.css"><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js"></script><script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js"></script><script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js"></script><script src="firebase-config.js"></script></head><body class="bg-gradient-to-br from-indigo-50 via-pink-50 to-yellow-50 font-poppins p-6 min-h-screen"><div class="max-w-6xl mx-auto"><div class="flex justify-between items-center mb-6"><h1 class="text-2xl font-bold">Admin Dashboard</h1><div><button id="logout" class="px-3 py-1 rounded-full border">Logout</button></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div class="card p-4 glass rounded-xl"><h3 class="font-semibold mb-2">Satisfaction (Bar)</h3><canvas id="barChart" height="140"></canvas></div><div class="card p-4 glass rounded-xl"><h3 class="font-semibold mb-2">Satisfaction (Pie)</h3><canvas id="pieChart" height="140"></canvas></div></div><div class="card p-4 glass rounded-xl"><div class="flex justify-between items-center mb-2"><h3 class="font-semibold">Responses</h3><div><button id="downloadCsv" class="px-3 py-1 rounded-full border">Download CSV</button></div></div><div id="tableWrap" class="overflow-auto max-h-96"></div></div></div><script>firebase.auth().onAuthStateChanged(user=>{ if(!user) window.location.href='admin.html'; else loadResponses(); }); document.getElementById('logout').addEventListener('click', ()=> firebase.auth().signOut().then(()=> window.location.href='index.html')); async function loadResponses(){ const db=firebase.firestore(); const snap=await db.collection('responses').orderBy('timestamp','desc').get(); const rows=[]; snap.forEach(d=>rows.push(d.data())); if(rows.length===0){ document.getElementById('tableWrap').innerHTML='<div class="text-sm text-slate-600">No responses yet.</div>'; return; } const keys=Object.keys(rows[0]); let html='<table class="min-w-full text-sm">'; html+='<thead><tr class="text-left"><th class="p-2">#</th>'; keys.forEach(k=> html+='<th class="p-2">'+k+'</th>'); html+='</tr></thead><tbody>'; rows.forEach((r,i)=>{ html+='<tr class="border-t"><td class="p-2 align-top">'+(i+1)+'</td>'; keys.forEach(k=> html+='<td class="p-2 align-top">'+(r[k]||'')+'</td>'); html+='</tr>'; }); html+='</tbody></table>'; document.getElementById('tableWrap').innerHTML = html; buildCharts(rows); document.getElementById('downloadCsv').onclick = ()=>{ const header = keys.join(','); const lines=[header]; rows.forEach(r=>{ const line = keys.map(k=>'"'+String(r[k]||'').replace(/"/g,'""')+'"').join(','); lines.push(line); }); const blob=new Blob([lines.join('\n')],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='responses.csv'; a.click(); URL.revokeObjectURL(url); }; } function buildCharts(rows){ const counts={}; rows.forEach(r=>{ const s=r.satisfaction||'No answer'; counts[s]=(counts[s]||0)+1; }); const labels=Object.keys(counts); const values=labels.map(l=>counts[l]); const bctx=document.getElementById('barChart').getContext('2d'); if(window._bar) window._bar.destroy(); window._bar = new Chart(bctx,{type:'bar',data:{labels,datasets:[{label:'Responses',data:values}]}}); const pctx=document.getElementById('pieChart').getContext('2d'); if(window._pie) window._pie.destroy(); window._pie=new Chart(pctx,{type:'pie',data:{labels,datasets:[{data:values}]}}); }</script></body></html>